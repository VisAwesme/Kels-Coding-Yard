<#
.SYNOPSIS
    Forcefully terminates all processes named "memz.exe" or "memez.exe" simultaneously.
.DESCRIPTION
    This script searches for running processes with names that match "memz.exe" or "memez.exe". 
    It then launches background jobs to kill them all in parallel to minimize any delay that could 
    let the malware progress to a more dangerous "Phase 2". 
    Designed for use in a controlled environment (e.g., a triage VM).
.NOTES
    Run this script with Administrator privileges.
#>

# Ensure the script is running as Administrator
if (-not ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator"))
{
    Write-Error "This script must be run as Administrator. Please run it using 'Run as Administrator'."
    exit 1
}

# Define the process name variants to target
$processNames = @("memz.exe", "memez.exe")

# Array to hold background jobs
$jobs = @()

Write-Host "Searching for malicious processes..." -ForegroundColor Cyan

foreach ($name in $processNames) {
    # Get processes matching the name (case-insensitive)
    $procs = Get-Process -Name $name -ErrorAction SilentlyContinue
    if ($procs) {
        foreach ($proc in $procs) {
            Write-Host "Scheduling kill for $($proc.Name) (PID: $($proc.Id))" -ForegroundColor Yellow
            # Start a background job to kill this process
            $job = Start-Job -ScriptBlock {
                param($pid)
                try {
                    Stop-Process -Id $pid -Force -ErrorAction Stop
                    Write-Output "Killed process with PID $pid"
                }
                catch {
                    Write-Output "Failed to kill process with PID $pid: $_"
                }
            } -ArgumentList $proc.Id
            $jobs += $job
        }
    }
    else {
        Write-Host "No processes found matching: $name" -ForegroundColor Green
    }
}

# Wait for all jobs to complete
if ($jobs.Count -gt 0) {
    Write-Host "Waiting for all kill jobs to finish..." -ForegroundColor Cyan
    Wait-Job -Job $jobs
    # Optionally, output the results of each job
    foreach ($job in $jobs) {
        Receive-Job -Job $job
    }
    # Verify if any instance is still running
    $remaining = @()
    foreach ($name in $processNames) {
        $remaining += Get-Process -Name $name -ErrorAction SilentlyContinue
    }
    if ($remaining.Count -eq 0) {
        Write-Host "All instances of memz.exe/memez.exe have been terminated." -ForegroundColor Green
    }
    else {
        Write-Warning "Some instances may still be running!"
    }
}
else {
    Write-Host "No malicious processes were found to terminate." -ForegroundColor Green
}

Write-Host "Script execution completed." -ForegroundColor Cyan
